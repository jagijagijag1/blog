<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>GCP on jagijagijag1 notes</title><link>http://jagijagijag1.github.io/blog/tags/gcp/</link><description>Recent content in GCP on jagijagijag1 notes</description><generator>Hugo -- gohugo.io</generator><language>ja-jp</language><lastBuildDate>Sat, 23 Nov 2019 10:38:40 +0900</lastBuildDate><atom:link href="http://jagijagijag1.github.io/blog/tags/gcp/index.xml" rel="self" type="application/rss+xml"/><item><title>Cloue Run + Puppeteer + Cloud Schedulebr でサーバーレスなクロールを定期実行する</title><link>http://jagijagijag1.github.io/blog/posts/2019_11_23/</link><pubDate>Sat, 23 Nov 2019 10:38:40 +0900</pubDate><guid>http://jagijagijag1.github.io/blog/posts/2019_11_23/</guid><description>つくるもの 手軽に定期実行するクローラを作りたかった 題材として，あすけん のスコア(健康度)をPixelaに転記する処理を1日1回実行する自動化システムをつくる 転記の結果 つまづきメモ AWS LambdaをやめてGCP Cloud Runを選択 まず最初に，ローカルでPuppeteerを用いてaskenをcrawl → pixelaへ記録する機能を開発 asken2pixela/local GitHub これをベースにPuppeterr on Lambdaでサーバーレスな定期クロールを実現するつもりだった ref: Puppeteer on AWS LambdaをTypescriptからサクッと使う(2019年9月版) - ADliveテックブログ が，Page.$$eval()の返り値が通常のPuppeteerとLambda用のPuppeteerとで違った… 通常のPuppeteer: Array&amp;lt;Element&amp;gt;が返ってきた Lambda用のPuppeteer: Array&amp;lt;ElementHandle&amp;gt;が返ってきた このギャップを埋める修正が面倒なので，ローカルで動いているコード(=普通のPuppeteer)をサーバーレスで動かせばいいのでは? → Cloud Runがある！ Cloud Run: リクエストに応じてコンテナを起動・処理するサーバーレスなGCPのサービス Puppeteerのevalなどで渡す関数内処理のロギング PuppeteerのPage.$$eval()などの引数で渡す関数内でconsole.log()でログを取りたかったが，そのまま書いてもスコープが変わるためコンソール出力されない これに対し，consleイベントをdispatchすることができたため，Pageオブジェクトに対して下記処理を実施し，Page.$$eval()内のログ出力に成功 ref: javascript - Puppeteer log inside page.evaluate - Stack Overflow const browser = await puppeteer.</description></item></channel></rss>